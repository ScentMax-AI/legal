  <!DOCTYPE html>
  <html>
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Reset Password - ScentMax AI</title>
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
      <style>
          * { box-sizing: border-box; margin: 0; padding: 0; }
          body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #09090B; color: #FAFAFA; min-height: 100vh; display:
  flex; align-items: center; justify-content: center; padding: 20px; }
          .container { max-width: 400px; width: 100%; }
          h1 { font-size: 24px; margin-bottom: 8px; text-align: center; }
          p { color: #A1A1AA; margin-bottom: 24px; text-align: center; }
          .form-group { margin-bottom: 16px; }
          label { display: block; font-size: 14px; margin-bottom: 8px; color: #FAFAFA; }
          input { width: 100%; padding: 14px 16px; border-radius: 12px; border: 1px solid #27272A; background: #16161A; color: #FAFAFA; font-size: 16px; }
          input:focus { outline: none; border-color: #8B5CF6; }
          button { width: 100%; padding: 16px; border-radius: 12px; border: none; background: linear-gradient(90deg, #8B5CF6, #A78BFA); color: white; font-size:
  16px; font-weight: 600; cursor: pointer; margin-top: 8px; }
          button:disabled { opacity: 0.6; cursor: not-allowed; }
          .message { padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center; }
          .error { background: #7F1D1D; color: #FCA5A5; }
          .success { background: #14532D; color: #86EFAC; }
          .info { background: #1E3A5F; color: #93C5FD; }
          .logo { text-align: center; margin-bottom: 32px; font-size: 32px; }
      </style>
  </head>
  <body>
      <div class="container">
          <div class="logo">ðŸŒ¸</div>
          <h1>Reset Your Password</h1>
          <p>Enter your new password below</p>
          <div id="message"></div>
          <form id="resetForm">
              <div class="form-group">
                  <label>New Password</label>
                  <input type="password" id="password" placeholder="Enter new password" minlength="8" required>
              </div>
              <div class="form-group">
                  <label>Confirm Password</label>
                  <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
              </div>
              <button type="submit" id="submitBtn">Update Password</button>
          </form>
      </div>
      <script>
          const SUPABASE_URL = 'https://rkttvbvfkoazxbfzpjba.supabase.co';
          const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJrdHR2YnZma29henhiZnpwamJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTA3OTAsImV4cCI6MjA4MDIyNjc5MH0.soecDP5vtKbx-oixZP8e0Y2K9FLnAIt4mv2XDXM-_-s';

          const messageDiv = document.getElementById('message');
          const resetForm = document.getElementById('resetForm');
          const submitBtn = document.getElementById('submitBtn');

          function showMessage(text, type) {
              messageDiv.className = 'message ' + type;
              messageDiv.textContent = text;
          }

          function showError(text) {
              showMessage(text, 'error');
          }

          function showSuccess(text) {
              showMessage(text, 'success');
          }

          function showInfo(text) {
              showMessage(text, 'info');
          }

          let supabase;
          let sessionReady = false;

          try {
              supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
              showInfo('Initializing...');
          } catch (e) {
              showError('Failed to initialize: ' + e.message);
          }

          const hash = window.location.hash.substring(1);
          const params = new URLSearchParams(hash);
          const accessToken = params.get('access_token');
          const refreshToken = params.get('refresh_token');
          const type = params.get('type');

          if (!accessToken || !refreshToken) {
              showError('Invalid reset link. Missing tokens. Please request a new one from the app.');
              resetForm.style.display = 'none';
          } else if (type !== 'recovery') {
              showError('Invalid reset link type: ' + type + '. Please request a new one from the app.');
              resetForm.style.display = 'none';
          } else {
              showInfo('Setting up session...');
              supabase.auth.setSession({ access_token: accessToken, refresh_token: refreshToken })
                  .then(function(result) {
                      if (result.error) {
                          showError('Session error: ' + result.error.message);
                          resetForm.style.display = 'none';
                      } else {
                          sessionReady = true;
                          showInfo('Ready! Enter your new password.');
                      }
                  })
                  .catch(function(e) {
                      showError('Session setup failed: ' + e.message);
                      resetForm.style.display = 'none';
                  });
          }

          resetForm.addEventListener('submit', function(e) {
              e.preventDefault();

              if (!sessionReady) {
                  showError('Session not ready. Please refresh and try again.');
                  return;
              }

              var password = document.getElementById('password').value;
              var confirmPassword = document.getElementById('confirmPassword').value;

              if (password !== confirmPassword) {
                  showError('Passwords do not match');
                  return;
              }

              if (password.length < 8) {
                  showError('Password must be at least 8 characters');
                  return;
              }

              submitBtn.disabled = true;
              submitBtn.textContent = 'Updating...';
              showInfo('Updating password...');

              supabase.auth.updateUser({ password: password })
                  .then(function(result) {
                      if (result.error) {
                          showError('Update failed: ' + result.error.message);
                          submitBtn.disabled = false;
                          submitBtn.textContent = 'Update Password';
                      } else {
                          showSuccess('Password updated successfully! You can now close this page and log in with your new password.');
                          resetForm.style.display = 'none';
                      }
                  })
                  .catch(function(e) {
                      showError('Update error: ' + e.message);
                      submitBtn.disabled = false;
                      submitBtn.textContent = 'Update Password';
                  });
          });
      </script>
  </body>
  </html>
